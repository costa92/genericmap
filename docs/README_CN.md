# GenericMap

[![Go Version](https://img.shields.io/badge/go-%3E%3D1.25-blue.svg)](https://golang.org/)
[![æµ‹è¯•è¦†ç›–ç‡](https://img.shields.io/badge/coverage-98.5%25-brightgreen.svg)](./MAKEFILE_CN.md)
[![è®¸å¯è¯](https://img.shields.io/badge/license-MIT-blue.svg)](LICENSE)
[![Go Report Card](https://goreportcard.com/badge/github.com/costa92/genericmap)](https://goreportcard.com/report/github.com/costa92/genericmap)

é«˜æ€§èƒ½ã€çº¿ç¨‹å®‰å…¨çš„Goæ³›å‹åŒå‘æ˜ å°„å®ç°ï¼Œæ”¯æŒO(1)æ“ä½œå’Œå…¨é¢çš„åå‘æŸ¥æ‰¾åŠŸèƒ½ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

- ğŸš€ **é«˜æ€§èƒ½**: O(1) æ—¶é—´å¤æ‚åº¦çš„è®¾ç½®ã€è·å–å’Œåˆ é™¤æ“ä½œ
- ğŸ”„ **åŒå‘æŸ¥æ‰¾**: é«˜æ•ˆçš„æ­£å‘ï¼ˆé”®â†’å€¼ï¼‰å’Œåå‘ï¼ˆå€¼â†’é”®é›†åˆï¼‰æŸ¥æ‰¾
- ğŸ”’ **çº¿ç¨‹å®‰å…¨**: å†…ç½®RWMutexå®ç°å¹¶å‘è®¿é—®æ”¯æŒ
- ğŸ¯ **æ³›å‹æ”¯æŒ**: åŸºäºGoæ³›å‹çš„ç±»å‹å®‰å…¨ï¼Œæ”¯æŒä»»ä½•å¯æ¯”è¾ƒç±»å‹
- ğŸ“Š **å†…å­˜ä¼˜åŒ–**: å‡å°‘å†…å­˜åˆ†é…å’ŒGCå‹åŠ›
- ğŸ§ª **å……åˆ†æµ‹è¯•**: 98.5%æµ‹è¯•è¦†ç›–ç‡ï¼ŒåŒ…å«å…¨é¢çš„åŸºå‡†æµ‹è¯•

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
go get github.com/costa92/genericmap
```

### åŸºæœ¬ç”¨æ³•

```go
package main

import (
    "fmt"
    "github.com/costa92/genericmap"
)

func main() {
    // åˆ›å»ºæ–°çš„æ˜ å°„
    m := genericmap.New[string, int]()
    
    // æ·»åŠ é”®å€¼å¯¹
    m.Set("è‹¹æœ", 5)
    m.Set("é¦™è•‰", 2)
    m.Set("æ¨±æ¡ƒ", 5)
    
    // é€šè¿‡é”®è·å–å€¼
    if value, exists := m.Get("è‹¹æœ"); exists {
        fmt.Printf("è‹¹æœ: %dä¸ª\n", value) // è‹¹æœ: 5ä¸ª
    }
    
    // åå‘æŸ¥æ‰¾ - æŸ¥æ‰¾å€¼ä¸º5çš„æ‰€æœ‰é”®
    keys := m.GetKeys(5)
    fmt.Printf("æ•°é‡ä¸º5çš„æ°´æœ: %v\n", keys) // [è‹¹æœ æ¨±æ¡ƒ]
    
    // åˆ é™¤é¡¹ç›®
    removed := m.Remove("é¦™è•‰")
    fmt.Printf("å·²åˆ é™¤é¦™è•‰: %t\n", removed) // true
}
```

## ğŸ“– API æ–‡æ¡£

### åˆ›å»ºæ˜ å°„

```go
// åˆ›å»ºç©ºæ˜ å°„
m := genericmap.New[string, int]()

// ä½¿ç”¨åˆå§‹æ•°æ®åˆ›å»º
initial := map[string]int{"å¼ ä¸‰": 25, "æå››": 30}
m := genericmap.New[string, int](initial)

// æŒ‡å®šå®¹é‡åˆ›å»ºï¼ˆæ€§èƒ½ä¼˜åŒ–ï¼‰
m := genericmap.NewWithCapacity[string, int](1000)
```

### æ ¸å¿ƒæ“ä½œ

```go
// è®¾ç½®/æ›´æ–°
m.Set("ç”¨æˆ·ID", 12345)

// è·å–
value, exists := m.Get("ç”¨æˆ·ID")

// åˆ é™¤
removed := m.Remove("ç”¨æˆ·ID")

// è·å–å¤§å°
size := m.Len()
```

### åŒå‘æŸ¥æ‰¾

```go
// è·å–ç‰¹å®šå€¼å¯¹åº”çš„æ‰€æœ‰é”®
keys := m.GetKeys(12345)

// åˆ—å‡ºæ‰€æœ‰é”®
allKeys := m.List()

// åˆ—å‡ºæ‰€æœ‰å€¼
allValues := m.Values()
```

### çº¿ç¨‹å®‰å…¨

```go
// å¹¶å‘è®¿é—®å®‰å…¨
var wg sync.WaitGroup

// å¤šä¸ªgoroutineå¯ä»¥å®‰å…¨åœ°è®¿é—®æ˜ å°„
for i := 0; i < 10; i++ {
    wg.Add(1)
    go func(id int) {
        defer wg.Done()
        m.Set(fmt.Sprintf("ç”¨æˆ·-%d", id), id)
        value, _ := m.Get(fmt.Sprintf("ç”¨æˆ·-%d", id))
        keys := m.GetKeys(id)
        fmt.Printf("åç¨‹ %d: å€¼=%d, é”®=%v\n", id, value, keys)
    }(i)
}

wg.Wait()
```

## ğŸï¸ æ€§èƒ½è¡¨ç°

### åŸºå‡†æµ‹è¯•ç»“æœ (Apple M1)

| æ“ä½œ | æ—¶é—´/æ“ä½œ | åˆ†é…æ¬¡æ•°/æ“ä½œ | å­—èŠ‚/æ“ä½œ |
|------|-----------|---------------|-----------|
| Set | 426.2 ns | 1 | 76 B |
| Get | 14.34 ns | 0 | 0 B |
| GetKeys | 771.9 ns | 2 | 904 B |
| Remove | 248.5 ns | 0 | 0 B |
| å¹¶å‘è¯»å†™ | 142.2 ns | 1 | 32 B |

### æ€§èƒ½ä¼˜åŒ–

- **O(1) æ“ä½œ**: è®¾ç½®ã€è·å–å’Œåˆ é™¤æ“ä½œéƒ½æ˜¯å¸¸æ•°æ—¶é—´å¤æ‚åº¦
- **ä¼˜åŒ–åå‘æŸ¥æ‰¾**: ä½¿ç”¨ `map[V]map[K]struct{}` è€Œé `map[V][]K` å®ç°O(1)åˆ é™¤
- **å‡å°‘åˆ†é…**: æ“ä½œæœŸé—´æœ€å°åŒ–å†…å­˜åˆ†é…
- **å•æ¬¡æŸ¥æ‰¾**: æ¶ˆé™¤Setæ“ä½œä¸­çš„å†—ä½™æŸ¥æ‰¾

## ğŸ“‹ ä½¿ç”¨åœºæ™¯

### ç”¨æˆ·-è§’è‰²æ˜ å°„

```go
// ç”¨æˆ·IDåˆ°è§’è‰²åçš„æ˜ å°„ï¼Œæ”¯æŒåå‘æŸ¥æ‰¾
userRoles := genericmap.New[int, string]()

userRoles.Set(1001, "ç®¡ç†å‘˜")
userRoles.Set(1002, "æ™®é€šç”¨æˆ·")
userRoles.Set(1003, "ç®¡ç†å‘˜")

// æŸ¥æ‰¾æ‰€æœ‰ç®¡ç†å‘˜ç”¨æˆ·
adminUsers := userRoles.GetKeys("ç®¡ç†å‘˜") // [1001, 1003]
```

### ç¼“å­˜ç³»ç»Ÿ

```go
// å¸¦åå‘ç´¢å¼•çš„ç¼“å­˜ç³»ç»Ÿ
cache := genericmap.New[string, []byte]()

cache.Set("ç”¨æˆ·:123", []byte("ç”¨æˆ·æ•°æ®"))
cache.Set("æ–‡ç« :456", []byte("æ–‡ç« æ•°æ®"))

// æ ¹æ®ç¼“å­˜å€¼æŸ¥æ‰¾é”®
keys := cache.GetKeys([]byte("ç”¨æˆ·æ•°æ®")) // ["ç”¨æˆ·:123"]
```

### é…ç½®ç®¡ç†

```go
// é…ç½®é¡¹ç®¡ç†ï¼Œæ”¯æŒæŒ‰ç¯å¢ƒåˆ†ç»„
config := genericmap.New[string, string]()

config.Set("æ•°æ®åº“.ä¸»æœº", "ç”Ÿäº§ç¯å¢ƒ")
config.Set("ç¼“å­˜.ä¸»æœº", "ç”Ÿäº§ç¯å¢ƒ")
config.Set("é˜Ÿåˆ—.ä¸»æœº", "æµ‹è¯•ç¯å¢ƒ")

// æŸ¥æ‰¾æ‰€æœ‰ç”Ÿäº§ç¯å¢ƒæœåŠ¡
prodServices := config.GetKeys("ç”Ÿäº§ç¯å¢ƒ") // ["æ•°æ®åº“.ä¸»æœº", "ç¼“å­˜.ä¸»æœº"]
```

### å•†å“åˆ†ç±»ç³»ç»Ÿ

```go
// å•†å“IDåˆ°åˆ†ç±»çš„æ˜ å°„
products := genericmap.New[string, string]()

products.Set("P001", "ç”µå­äº§å“")
products.Set("P002", "æœè£…")
products.Set("P003", "ç”µå­äº§å“")
products.Set("P004", "ä¹¦ç±")

// æŸ¥æ‰¾ç‰¹å®šåˆ†ç±»ä¸‹çš„æ‰€æœ‰å•†å“
electronics := products.GetKeys("ç”µå­äº§å“") // ["P001", "P003"]
```

## ğŸ› ï¸ å¼€å‘æŒ‡å—

### ç¯å¢ƒè¦æ±‚

- Go 1.25 æˆ–æ›´é«˜ç‰ˆæœ¬
- Makeï¼ˆå¯é€‰ï¼Œç”¨äºä½¿ç”¨Makefileå‘½ä»¤ï¼‰

### æ„å»ºå’Œæµ‹è¯•

```bash
# è¿è¡Œæ‰€æœ‰æµ‹è¯•
make test

# è¿è¡ŒåŸºå‡†æµ‹è¯•
make bench

# è¿è¡Œæµ‹è¯•å¹¶ç”Ÿæˆè¦†ç›–ç‡æŠ¥å‘Š
make test-coverage

# æ ¼å¼åŒ–å’Œæ£€æŸ¥ä»£ç 
make check

# æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨å‘½ä»¤
make help
```

### é¡¹ç›®ç»“æ„

```
â”œâ”€â”€ map.go              # æ ¸å¿ƒå®ç°
â”œâ”€â”€ map_test.go         # å•å…ƒæµ‹è¯•
â”œâ”€â”€ example_test.go     # ç¤ºä¾‹æµ‹è¯•
â”œâ”€â”€ benchmark_test.go   # æ€§èƒ½åŸºå‡†æµ‹è¯•
â”œâ”€â”€ Makefile           # æ„å»ºè‡ªåŠ¨åŒ–
â”œâ”€â”€ MAKEFILE.md        # è‹±æ–‡Makeå‘½ä»¤æ–‡æ¡£
â”œâ”€â”€ MAKEFILE_CN.md     # ä¸­æ–‡Makeå‘½ä»¤æ–‡æ¡£
â”œâ”€â”€ README.md          # è‹±æ–‡é¡¹ç›®è¯´æ˜
â””â”€â”€ README_CN.md       # ä¸­æ–‡é¡¹ç›®è¯´æ˜ï¼ˆæœ¬æ–‡ä»¶ï¼‰
```

## ğŸ§ª æµ‹è¯•

é¡¹ç›®é€šè¿‡å…¨é¢çš„æµ‹è¯•ä¿æŒé«˜ä»£ç è´¨é‡ï¼š

- **å•å…ƒæµ‹è¯•**: æ‰€æœ‰åŠŸèƒ½çš„å®Œæ•´è¦†ç›–
- **ç¤ºä¾‹æµ‹è¯•**: æœ‰æ–‡æ¡£çš„ä½¿ç”¨ç¤ºä¾‹
- **åŸºå‡†æµ‹è¯•**: æ€§èƒ½å›å½’æµ‹è¯•
- **ç«æ€æµ‹è¯•**: å¹¶å‘è®¿é—®éªŒè¯
- **è¦†ç›–ç‡**: 98.5% æµ‹è¯•è¦†ç›–ç‡

è¿è¡Œæµ‹è¯•ï¼š

```bash
# åŸºç¡€æµ‹è¯•
go test -v

# å¸¦ç«æ€æ£€æµ‹
go test -race -v

# å¸¦è¦†ç›–ç‡
go test -cover -v
```

## ğŸ”§ é«˜çº§ç”¨æ³•

### è‡ªå®šä¹‰ç±»å‹

```go
type ç”¨æˆ·ID int
type éƒ¨é—¨åç§° string

userMap := genericmap.New[ç”¨æˆ·ID, éƒ¨é—¨åç§°]()
userMap.Set(ç”¨æˆ·ID(1001), éƒ¨é—¨åç§°("æŠ€æœ¯éƒ¨"))
```

### æ€§èƒ½è°ƒä¼˜

```go
// é¢„åˆ†é…å®¹é‡ä»¥è·å¾—æ›´å¥½æ€§èƒ½
expectedSize := 10000
m := genericmap.NewWithCapacity[string, int](expectedSize)

// æ‰¹é‡æ“ä½œ
for i := 0; i < expectedSize; i++ {
    m.Set(fmt.Sprintf("é”®-%d", i), i)
}
```

### é”™è¯¯å¤„ç†

```go
// æ“ä½œå‰æ£€æŸ¥é”®æ˜¯å¦å­˜åœ¨
if value, exists := m.Get("é”®"); exists {
    // å¤„ç†ç°æœ‰å€¼
    fmt.Printf("æ‰¾åˆ°: %v\n", value)
} else {
    // å¤„ç†ç¼ºå¤±çš„é”®
    fmt.Println("é”®ä¸å­˜åœ¨")
}

// æ£€æŸ¥åˆ é™¤æ˜¯å¦æˆåŠŸ
if removed := m.Remove("é”®"); removed {
    fmt.Println("æˆåŠŸåˆ é™¤")
} else {
    fmt.Println("é”®ä¸å­˜åœ¨")
}
```

## ğŸ“Š ä¸å…¶ä»–æ–¹æ¡ˆå¯¹æ¯”

| ç‰¹æ€§ | GenericMap | sync.Map | æ™®é€šmap + mutex |
|------|------------|----------|-----------------|
| ç±»å‹å®‰å…¨ | âœ… æ³›å‹ | âŒ interface{} | âœ… ç±»å‹åŒ– |
| åå‘æŸ¥æ‰¾ | âœ… O(1) | âŒ ä¸æ”¯æŒ | âŒ O(n) æ‰«æ |
| æ€§èƒ½ | âš¡ ä¼˜åŒ– | ğŸŒ æ¥å£å¼€é”€ | ğŸ’¾ å†…å­˜é«˜æ•ˆ |
| çº¿ç¨‹å®‰å…¨ | âœ… å†…ç½® | âœ… å†…ç½® | âš™ï¸ æ‰‹åŠ¨ |
| API ç®€æ´æ€§ | âœ… æ¸…æ™° | âŒ å¤æ‚ | âœ… ç®€å• |

## ğŸ¤ è´¡çŒ®

æ¬¢è¿è´¡çŒ®ä»£ç ï¼è¯·éšæ—¶æäº¤Pull Requestã€‚å¯¹äºé‡å¤§æ›´æ”¹ï¼Œè¯·å…ˆå¼€issueè®¨è®ºæ‚¨æƒ³è¦æ›´æ”¹çš„å†…å®¹ã€‚

### å¼€å‘å·¥ä½œæµ

1. Fork ä»“åº“
2. åˆ›å»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/amazing-feature`)
3. è¿è¡Œæµ‹è¯• (`make dev`)
4. æäº¤æ›´æ”¹ (`git commit -am 'æ·»åŠ amazingåŠŸèƒ½'`)
5. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/amazing-feature`)
6. å¼€å¯Pull Request

### ä»£ç è§„èŒƒ

- éµå¾ªGoçº¦å®šå’Œæœ€ä½³å®è·µ
- è¿è¡Œ `make fmt` æ ¼å¼åŒ–ä»£ç 
- ç¡®ä¿ `make ci` é€šè¿‡åå†æäº¤PR
- ä¿æŒæµ‹è¯•è¦†ç›–ç‡åœ¨95%ä»¥ä¸Š

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®é‡‡ç”¨MITè®¸å¯è¯ - è¯¦æƒ…è¯·è§ [LICENSE](LICENSE) æ–‡ä»¶ã€‚

## ğŸ™ è‡´è°¢

- Goå›¢é˜Ÿæä¾›çš„ä¼˜ç§€æ³›å‹å®ç°
- ç¤¾åŒºåé¦ˆå’Œè´¡çŒ®
- Goç¤¾åŒºçš„æ€§èƒ½ä¼˜åŒ–æŠ€æœ¯

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [English README](./README.md)
- [è‹±æ–‡ Make å‘½ä»¤æ–‡æ¡£](./MAKEFILE.md)
- [ä¸­æ–‡ Make å‘½ä»¤æ–‡æ¡£](./MAKEFILE_CN.md)
- [Go åŒ…æ–‡æ¡£](https://pkg.go.dev/github.com/costa92/genericmap)

## ğŸ”— ç›¸å…³é“¾æ¥

- [GitHub ä»“åº“](https://github.com/costa92/genericmap)
- [Go åŒ…ç´¢å¼•](https://pkg.go.dev/github.com/costa92/genericmap)
- [é—®é¢˜è¿½è¸ª](https://github.com/costa92/genericmap/issues)

## ğŸ¯ æœ€ä½³å®è·µ

### æ€§èƒ½ä¼˜åŒ–å»ºè®®

1. **é¢„åˆ†é…å®¹é‡**: å¦‚æœçŸ¥é“é¢„æœŸå¤§å°ï¼Œä½¿ç”¨ `NewWithCapacity`
2. **æ‰¹é‡æ“ä½œ**: å°½é‡å‡å°‘é”çš„äº‰ç”¨
3. **åˆç†ä½¿ç”¨åå‘æŸ¥æ‰¾**: åœ¨éœ€è¦é¢‘ç¹åå‘æŸ¥æ‰¾çš„åœºæ™¯ä¸‹ä½¿ç”¨

### å†…å­˜ç®¡ç†

1. **åŠæ—¶æ¸…ç†**: åˆ é™¤ä¸éœ€è¦çš„é”®å€¼å¯¹
2. **é¿å…å†…å­˜æ³„æ¼**: æ³¨æ„å¤§å¯¹è±¡çš„å¼•ç”¨
3. **ç›‘æ§æ€§èƒ½**: ä½¿ç”¨åŸºå‡†æµ‹è¯•ç›‘æ§æ€§èƒ½å˜åŒ–

### å¹¶å‘ä½¿ç”¨

1. **è¯»å¤šå†™å°‘**: å……åˆ†åˆ©ç”¨RWMutexçš„è¯»å†™åˆ†ç¦»
2. **é¿å…é•¿æ—¶é—´æŒé”**: å¿«é€Ÿå®Œæˆæ“ä½œåé‡Šæ”¾é”
3. **åˆç†çš„å¹¶å‘ç²’åº¦**: é¿å…è¿‡åº¦å¹¶å‘å¯¼è‡´é”äº‰ç”¨

## ğŸ”® æœªæ¥è®¡åˆ’

- [ ] æ”¯æŒæ›´å¤šçš„æŸ¥è¯¢æ–¹å¼
- [ ] æ·»åŠ åºåˆ—åŒ–æ”¯æŒ
- [ ] æä¾›æ›´å¤šçš„ç»Ÿè®¡ä¿¡æ¯
- [ ] æ”¯æŒè‡ªå®šä¹‰æ¯”è¾ƒå‡½æ•°

---

<p align="center">
  <strong>GenericMap</strong> - ä¸ºGoæä¾›é«˜æ€§èƒ½åŒå‘æ˜ å°„
</p>

<p align="center">
  å¦‚æœè¿™ä¸ªé¡¹ç›®å¯¹æ‚¨æœ‰å¸®åŠ©ï¼Œè¯·ç»™æˆ‘ä»¬ä¸€ä¸ªâ­ï¸
</p>